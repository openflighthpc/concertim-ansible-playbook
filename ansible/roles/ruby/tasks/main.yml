- name: Install ruby-build dependencies
  ansible.builtin.apt:
    name:
      - autoconf
      - bison
      - build-essential
      - libssl-dev
      - libyaml-dev
      - libreadline6-dev
      - zlib1g-dev
      - libncurses5-dev
      - libffi-dev
      - libgdbm6
      - libgdbm-dev
      - libdb-dev
      - uuid-dev
    state: latest

- name: Install ruby-build
  ansible.builtin.apt:
    name: ruby-build
    state: latest

- name: Build Rubies
  ansible.builtin.command:
    cmd: ruby-build {{ item }} /opt/ruby-{{ item }}
    creates: /opt/ruby-{{ item }}
  loop:
    - 1.8.7
    - 1.9.1-p431

- name: Link Rubies
  ansible.builtin.file:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    state: link
  loop:
    - src: /opt/ruby-1.8.7
      dest: /usr/bin/ruby1.8
    - src: /opt/ruby-1.9.1-p431
      dest: /opt/ruby-1.9.1
    - src: /opt/ruby-1.9.1-p431
      dest: /usr/bin/ruby1.9.1
    - src: /usr/bin/ruby1.9.1
      dest: /usr/bin/ruby1.9
